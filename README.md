# LVgs: A K-mer-based Pipeline for Robust Genome Size Estimation
LVgs is a novel and robust strategy for estimating the genus-level **g**enome **s**izes by plotting iteration of the large-scale estimates through continuous‌ ascent of K-mer lengths, ultimately identifying the **L**imiting **V**alue of wholescale-K forecasts with the strategic utilization of HiFi reads.

## Installation
LVgs is a lightweight, compile-free tool that combines shell scripting and R programming.

### 1. Pre-requisites
The following requirements are assumed to be installed (with path to their executables available in $PATH).

- [FastK](https://github.com/thegenemyers/FASTK)
- [GenomeScope2](https://github.com/tbenavi1/genomescope2.0)
- [HiFiasm](https://github.com/chhylp123/hifiasm)
- [tseries](https://CRAN.R-project.org/package=tseries)
- [KMC](https://github.com/refresh-bio/KMC) (optional)

### 2. Download
```
git clone https://github.com/xingjianfeng100/LVgs.git
cd LVgs
```
or
```
wget https://github.com/xingjianfeng100/LVgs/releases/download/*/LVgs-***.tar.gz
tar -xzvf  LVgs-***.tar.gz
cd LVgs-*** 
```
### 3. Set path to LVgs available in environment
```
export PATH=$PWD:$PATH
```
## Usage

```console
Usage: 	LVgs.sh -b stat_k-mer_size -e end_k-mer_size -i step_size -r reads
-b <INT>                                      K-mer length for beginning of loop forecasts (Bp)                                      [required]
-e <INT>                                      K-mer length for ending of loop forecasts (Bp)                                         [required]
-s <INT>                                      K-mer length iteration step size for loop forecasts (Bp)                               [required]
-r  <.cram|.[bs]am|.db|.dam|.f[ast][aq][.gz]> datasets for generating K-mers                                                         [required] 
-p  <INT>                                     ploidy (1, 2, 3, 4, 5, or 6) for GenomeScope2 to use                                   [default: 2]
-f                                            full mode to keep intermediate files                                                   [default: disabled]
-c                                            re-correct the HiFi consensus reads using hifiasm                                      [default: disabled]
-o  <output_prefix>                           prefix of the output files                                                             [default: out]
-t  <INT>                                     the number of threads to use                                                           [default: 1]
-M  <INT>                                     use -M GB of memory in K-mer counting steps of FastK                                   [default: 12]
-W  <workpdir>                                directory to execute loop forecasts                                                    [default: none]
-k <"-v|-t|-p|-bc|-c">                        other options for FastK, details see https://github.com/thegenemyers/FASTK             [default: none]
-g <"-l|-m......">                            other options for GenomeScope2, details see https://github.com/tbenavi1/genomescope2.0 [default: none]
-V                                            show version number
-h                                            display this help and exit
```
> [!NOTE]
> * Please try to keep K as an odd number to avoid generating palindromes. Palindromes are those where the forward and reverse complement sequences are identical.
> * ```-r <.cram|.[bs]am|.db|.dam|.f[ast][aq][.gz]>``` inputting reads need to specify absolute path.
> * Other options for FastK or GenomeScope2 should be enclosed in quotes, e.g., ```-k "-v -t4" -g "-m 1000000 --verbose"```.

### Outputs

```console
*.report                        #Final evaluation report for LVgs
*.stat.tab                      #Forecasts statistics with multi-K
*figure/                        #Genome size (GS) curve as well as other seven auxiliary indicators, Forecasted by multi-K
    ├── GS_linear_plot.pdf
    ├── kcov_plot.pdf
    ├── kmer_total_plot.pdf
    ├── kmer_type_plot.pdf
    ├── Model_fit_plot.pdf
    ├── Read_Error_plot.pdf
    ├── Repeat_linear_plot.pdf
    |__ Unique_linear_plot.pdf
*_limiV/                        #K-mer spectrum and K-mer histogram files with final-evaluation K
    ├── kmer.hist               #K-mer histogram file produced by FastK
    ├── k*.his                  #A special ASCII K-mer histogram file suitable for input to GenomeScope2 produced by Histex from 'kmer.hist' 
    |__ gsco_k*/                #K-mer spectrums generated by GenomeScope2
cor.ec.fa                       #Re-corrected HiFi reads generated by HiFiasm, if the "-c" parameter is set
```


## Examples
### Demo data downloading
A HiFi dateset generated from _Phthorimaea absoluta_ was used as an example.
```
wget  ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR234/030/SRR23497930/SRR23497930_subreads.fastq.gz
```
### Quick Start
```
LVgs.sh -b 17 -e 77 -s 10 -r /absolute/path/SRR23497930_subreads.fastq.gz  -t 32 -c -W demo
```
or use KMC to count K-mer
```
LVgs_kmc.sh -b 17 -e 77 -s 10 -r /absolute/path/SRR23497930_subreads.fastq.gz  -t 32 -c -W demo
```
result files are stored in ```demo/```
> [!NOTE]
> multi-datasets should add double quote, such as ```-r "/absolute/path/*.fastq.gz"``` 


## Contact
Other than raising issues in github, you can contact xingjianfeng100@126.com for specific issues.

## Cite
If you use our tools in your work, please cite:
+    Xing, J., Hao, J., Tang, C. et al. A closed-loop method for precise genome size estimation using HiFi reads. BMC Genomics 26, 878 (2025). https://doi.org/10.1186/s12864-025-12031-9.
We kindly ask that you also cite the following remarkable tools that have been integrated into LVgs:
+    FastK: https://github.com/thegenemyers/FASTK.
+    GenomeScope2: Ranallo-Benavidez, T. R., Jaron, K. S. & Schatz, M. C. GenomeScope 2.0 and Smudgeplot for reference-free profiling of polyploid genomes. Nat. Commun. 11, doi:10.1038/s41467-020-14998-3 (2020).
+    HiFiasm: Cheng, H., Asri, M., Lucas, J., Koren, S. & Li, H. Scalable telomere-to-telomere assembly for diploid and polyploid genomes with double graph. Nat Methods 21, 967-970, doi:10.1038/s41592-024-02269-8 (2024).
+    tseries: Trapletti, A. & Hornik, K. tseries: Time Series Analysis and Computational Finance. (R package version 0.10-58: https://CRAN.R-project.org/package=tseries, 2024)
+    KMC: Marek Kokot, Maciej Długosz, Sebastian Deorowicz, KMC 3: counting and manipulating k-mer statistics, Bioinformatics, Volume 33, Issue 17, 01 September 2017, Pages 2759–2761, https://doi.org/10.1093/bioinformatics/btx304. 
